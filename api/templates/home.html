{% extends "base.html" %}

{% block title %}SMOL - Spectra and Matrices Of Little graphs{% endblock %}

{% block content %}
<hgroup class="hero">
    <h1>SMOL Graphs DB</h1>
    <p>Spectra and matrices of all simple graphs with up to 10 vertices.</p>
</hgroup>

<h2 class="section-header">Query the DB</h2>

<div class="search-box" x-data="{ tab: 'lookup' }">
    <div class="tab-pills">
        <button type="button" :class="{ active: tab === 'lookup' }" @click="tab = 'lookup'">Lookup</button>
        <button type="button" :class="{ active: tab === 'compare' }" @click="tab = 'compare'">Compare</button>
        <button type="button" :class="{ active: tab === 'search' }" @click="tab = 'search'">Search</button>
    </div>

    <div class="tab-content" x-show="tab === 'lookup'">
        <p class="tab-hint">Look up a graph by its <a href="/glossary#graph6">graph6</a> encoding</p>
        <form class="lookup-form" onsubmit="window.location.href='/graph/' + encodeURIComponent(this.graph6.value); return false;">
            <input type="text" name="graph6" placeholder="e.g. D?{" required autocomplete="off">
            <button type="submit">Lookup</button>
        </form>
    </div>

    <div class="tab-content" x-show="tab === 'compare'">
        <p class="tab-hint">Compare multiple graphs side by side (2-10 <a href="/glossary#graph6">graph6</a> strings, one per line)</p>
        <form class="compare-form" onsubmit="compareGraphs(this); return false;">
            <textarea name="graphs" rows="3" placeholder="D?{&#10;DEo"></textarea>
            <button type="submit">Compare</button>
        </form>
    </div>

    <div class="tab-content" x-show="tab === 'search'">
        <p class="tab-hint">Find graphs by structural properties and tags</p>
        <form hx-get="/graphs" hx-target="#results" hx-trigger="submit" hx-indicator="#loading-indicator" class="search-form">
            <div class="search-columns">
                <div class="search-column">
                    <label>
                        <span>Vertices</span>
                        <select name="n">
                            <option value="">any</option>
                            {% for i in range(1, 11) %}
                            <option value="{{ i }}">{{ i }}</option>
                            {% endfor %}
                        </select>
                    </label>
                    <label>
                        <span>Edges</span>
                        <input type="number" name="m" min="0" max="45" placeholder="any">
                    </label>
                    <label>
                        <span>Min degree</span>
                        <input type="number" name="min_degree" min="0" placeholder="any">
                    </label>
                    <label>
                        <span>Max degree</span>
                        <input type="number" name="max_degree" min="0" placeholder="any">
                    </label>
                </div>
                <div class="search-column">
                    <label>
                        <span>Diameter</span>
                        <input type="number" name="diameter" min="0" placeholder="any">
                    </label>
                    <label>
                        <span>Radius</span>
                        <input type="number" name="radius" min="0" placeholder="any">
                    </label>
                    <label>
                        <span>Girth</span>
                        <input type="number" name="girth" min="0" placeholder="any">
                    </label>
                    <label>
                        <span>Triangles</span>
                        <input type="number" name="triangle_count" min="0" placeholder="any">
                    </label>
                </div>
                <div class="search-column">
                    <div x-data="{
                        selected: [],
                        open: false,
                        tags: ['complete', 'complete-bipartite', 'complete-multipartite', 'cubic', 'cycle', 'eulerian', 'fan', 'ladder', 'line-graph', 'path', 'petersen', 'prism', 'regular', 'star', 'strongly-regular', 'tree', 'triangle-free', 'vertex-transitive', 'wheel', 'windmill'],
                        toggle(tag) {
                            if (this.selected.includes(tag)) {
                                this.selected = this.selected.filter(t => t !== tag);
                            } else {
                                this.selected.push(tag);
                            }
                        },
                        remove(tag) {
                            this.selected = this.selected.filter(t => t !== tag);
                        }
                    }">
                        <div>
                            <span class="search-column-label">Tags</span>
                            <div class="multiselect-container">
                                <div class="multiselect-selected" @click.stop="open = !open">
                                    <span x-show="selected.length === 0" class="multiselect-placeholder">Select tags...</span>
                                    <template x-for="tag in selected" :key="tag">
                                        <span class="multiselect-chip">
                                            <span x-text="tag"></span>
                                            <button type="button" @click.stop="remove(tag)" class="chip-remove">×</button>
                                        </span>
                                    </template>
                                </div>
                                <div class="multiselect-dropdown" x-show="open" @click.away="open = false">
                                    <template x-for="tag in tags" :key="tag">
                                        <label class="multiselect-option">
                                            <input type="checkbox" :checked="selected.includes(tag)" @change="toggle(tag)">
                                            <span x-text="tag"></span>
                                        </label>
                                    </template>
                                </div>
                            </div>
                            <template x-for="tag in selected" :key="tag">
                                <input type="hidden" name="tags" :value="tag">
                            </template>
                        </div>
                        <label>
                            <span>Limit</span>
                            <select name="limit">
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="100" selected>100</option>
                                <option value="500">500</option>
                            </select>
                        </label>
                    </div>
                </div>
            </div>
            <button type="submit">Search</button>
        </form>
    </div>
</div>

<section id="results"></section>

<h2 class="section-header">Browse examples</h2>

<div class="examples-section" x-data="{ tab: 'examples' }">
    <div class="tab-pills">
        <button type="button" :class="{ active: tab === 'examples' }" @click="tab = 'examples'">Examples</button>
        <button type="button" :class="{ active: tab === 'adjacency' }" @click="tab = 'adjacency'">Adjacency</button>
        <button type="button" :class="{ active: tab === 'kirchhoff' }" @click="tab = 'kirchhoff'">Kirchhoff</button>
        <button type="button" :class="{ active: tab === 'signless' }" @click="tab = 'signless'">Signless</button>
        <button type="button" :class="{ active: tab === 'laplacian' }" @click="tab = 'laplacian'">Laplacian</button>
        <button type="button" :class="{ active: tab === 'nb' }" @click="tab = 'nb'">NB</button>
        <button type="button" :class="{ active: tab === 'nbl' }" @click="tab = 'nbl'">NBL</button>
    </div>

    <div class="tab-content" x-show="tab === 'examples'">
        <p class="examples-subtitle">Classic named graphs from graph theory</p>
        <div class="examples-grid">
            <a href="/graph/D~{" class="example-card">
                <div id="ex-k5" class="example-viz"></div>
                <div class="example-label">K₅ complete</div>
            </a>
            <a href="/graph/EEh_" class="example-card">
                <div id="ex-c6" class="example-viz"></div>
                <div class="example-label">C₆ cycle</div>
            </a>
            <a href="/graph/E%3FBw" class="example-card">
                <div id="ex-s6" class="example-viz"></div>
                <div class="example-label">S₆ star</div>
            </a>
            <a href="/graph/G%3FzTb_" class="example-card">
                <div id="ex-cube" class="example-viz"></div>
                <div class="example-label">Q₃ cube</div>
            </a>
            <a href="/graph/ICOf%40pSb%3F" class="example-card">
                <div id="ex-petersen" class="example-viz"></div>
                <div class="example-label">Petersen</div>
            </a>
            <a href="/graph/FEhfw" class="example-card">
                <div id="ex-wheel" class="example-viz"></div>
                <div class="example-label">W₆ wheel</div>
            </a>
        </div>
    </div>

    <div class="tab-content" x-show="tab === 'adjacency'">
        <p class="examples-subtitle">Graphs with identical adjacency spectra but different structure</p>
        <div class="cospectral-families">
        <a href="/compare?graphs=D%3F%7B,DEo" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-adj1a" class="example-viz"></div>
                    <code>D?{</code>
                </div>
                <div class="family-graph">
                    <div id="ex-adj1b" class="example-viz"></div>
                    <code>DEo</code>
                </div>
            </div>
        </a>
        <a href="/compare?graphs=F%3FABo,F%3FB%40g,F%3F%60b%3F" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-adj2a" class="example-viz"></div>
                    <code>F?ABo</code>
                </div>
                <div class="family-graph">
                    <div id="ex-adj2b" class="example-viz"></div>
                    <code>F?B@g</code>
                </div>
                <div class="family-graph">
                    <div id="ex-adj2c" class="example-viz"></div>
                    <code>F?`b?</code>
                </div>
            </div>
        </a>
        </div>
    </div>

    <div class="tab-content" x-show="tab === 'kirchhoff'">
        <p class="examples-subtitle">Graphs with identical Kirchhoff spectra but different structure</p>
        <div class="cospectral-families">
        <a href="/compare?graphs=ECZo,EEr_" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-kirchhoff1a" class="example-viz"></div>
                    <code>ECZo</code>
                </div>
                <div class="family-graph">
                    <div id="ex-kirchhoff1b" class="example-viz"></div>
                    <code>EEr_</code>
                </div>
            </div>
        </a>
        <a href="/compare?graphs=F%3FzVO,FCXkw,FCZfG" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-kirchhoff2a" class="example-viz"></div>
                    <code>F?zVO</code>
                </div>
                <div class="family-graph">
                    <div id="ex-kirchhoff2b" class="example-viz"></div>
                    <code>FCXkw</code>
                </div>
                <div class="family-graph">
                    <div id="ex-kirchhoff2c" class="example-viz"></div>
                    <code>FCZfG</code>
                </div>
            </div>
        </a>
        </div>
    </div>

    <div class="tab-content" x-show="tab === 'signless'">
        <p class="examples-subtitle">Graphs with identical signless Laplacian spectra but different structure</p>
        <div class="cospectral-families">
        <a href="/compare?graphs=E%3Fzw,ECfw" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-signless1a" class="example-viz"></div>
                    <code>E?zw</code>
                </div>
                <div class="family-graph">
                    <div id="ex-signless1b" class="example-viz"></div>
                    <code>ECfw</code>
                </div>
            </div>
        </a>
        <a href="/compare?graphs=FCZbw,FCZfg,FQjdg" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-signless2a" class="example-viz"></div>
                    <code>FCZbw</code>
                </div>
                <div class="family-graph">
                    <div id="ex-signless2b" class="example-viz"></div>
                    <code>FCZfg</code>
                </div>
                <div class="family-graph">
                    <div id="ex-signless2c" class="example-viz"></div>
                    <code>FQjdg</code>
                </div>
            </div>
        </a>
        </div>
    </div>

    <div class="tab-content" x-show="tab === 'laplacian'">
        <p class="examples-subtitle">Graphs with identical normalized Laplacian spectra but different structure</p>
        <div class="cospectral-families">
        <a href="/compare?graphs=F%3Fb~w,FEzfw" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-lap1a" class="example-viz"></div>
                    <code>F?b~w</code>
                </div>
                <div class="family-graph">
                    <div id="ex-lap1b" class="example-viz"></div>
                    <code>FEzfw</code>
                </div>
            </div>
        </a>
        <a href="/compare?graphs=E%3FBw,E%3F~o,EFz_" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-lap2a" class="example-viz"></div>
                    <code>E?Bw</code>
                </div>
                <div class="family-graph">
                    <div id="ex-lap2b" class="example-viz"></div>
                    <code>E?~o</code>
                </div>
                <div class="family-graph">
                    <div id="ex-lap2c" class="example-viz"></div>
                    <code>EFz_</code>
                </div>
            </div>
        </a>
        </div>
    </div>

    <div class="tab-content" x-show="tab === 'nb'">
        <p class="examples-subtitle">Graphs with identical non-backtracking spectra but different structure</p>
        <div class="cospectral-families">
        <a href="/compare?graphs=GCXmew,GCdevg" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-nb1a" class="example-viz"></div>
                    <code>GCXmew</code>
                </div>
                <div class="family-graph">
                    <div id="ex-nb1b" class="example-viz"></div>
                    <code>GCdevg</code>
                </div>
            </div>
        </a>
        <a href="/compare?graphs=H%3F%60DBjw,H%3F%60DUbs" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-nb2a" class="example-viz"></div>
                    <code>H?`DBjw</code>
                </div>
                <div class="family-graph">
                    <div id="ex-nb2b" class="example-viz"></div>
                    <code>H?`DUbs</code>
                </div>
            </div>
        </a>
        </div>
    </div>

    <div class="tab-content" x-show="tab === 'nbl'">
        <p class="examples-subtitle">Graphs with identical non-backtracking Laplacian spectra but different structure</p>
        <div class="cospectral-families">
        <a href="/compare?graphs=I%3Fqa%60hidg,I%3Fqa%60iYXg" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-nbl1a" class="example-viz"></div>
                    <code>I?qa`hidg</code>
                </div>
                <div class="family-graph">
                    <div id="ex-nbl1b" class="example-viz"></div>
                    <code>I?qa`iYXg</code>
                </div>
            </div>
        </a>
        <a href="/compare?graphs=I%3Fqa%60ngk_,I%3Fqadhik_" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-nbl2a" class="example-viz"></div>
                    <code>I?qa`ngk_</code>
                </div>
                <div class="family-graph">
                    <div id="ex-nbl2b" class="example-viz"></div>
                    <code>I?qadhik_</code>
                </div>
            </div>
        </a>
        </div>
    </div>
</div>

<script>
function compareGraphs(form) {
    const text = form.graphs.value.trim();
    const graphs = text.split(/[\n,]+/).map(g => g.trim()).filter(g => g);
    if (graphs.length < 2) {
        alert('Please enter at least 2 graphs to compare');
        return;
    }
    if (graphs.length > 10) {
        alert('Maximum 10 graphs allowed');
        return;
    }
    const params = graphs.map(g => encodeURIComponent(g)).join(',');
    window.location.href = '/compare?graphs=' + params;
}

const exampleGraphs = {
    // Example graphs
    'ex-k5': {n: 5, edges: [[0,1],[0,2],[0,3],[0,4],[1,2],[1,3],[1,4],[2,3],[2,4],[3,4]]},
    'ex-c6': {n: 6, edges: [[0,3],[0,4],[1,3],[1,5],[2,4],[2,5]]},
    'ex-s6': {n: 6, edges: [[0,5],[1,5],[2,5],[3,5],[4,5]]},
    'ex-cube': {n: 8, edges: [[0,4],[0,5],[0,6],[1,4],[1,5],[1,7],[2,4],[2,6],[2,7],[3,5],[3,6],[3,7]]},
    'ex-petersen': {n: 10, edges: [[0,3],[0,6],[0,9],[1,4],[1,6],[1,8],[2,5],[2,6],[2,7],[3,7],[3,8],[4,7],[4,9],[5,8],[5,9]]},
    'ex-wheel': {n: 7, edges: [[0,3],[0,4],[0,6],[1,3],[1,5],[1,6],[2,4],[2,5],[2,6],[3,6],[4,6],[5,6]]},
    // Adjacency cospectral
    'ex-adj1a': {n: 5, edges: [[0,4],[1,4],[2,4],[3,4]]},
    'ex-adj1b': {n: 5, edges: [[0,3],[0,4],[1,3],[1,4]]},
    'ex-adj2a': {n: 7, edges: [[0,5],[1,6],[2,6],[3,6],[4,6]]},
    'ex-adj2b': {n: 7, edges: [[0,5],[1,5],[2,6],[3,6],[5,6]]},
    'ex-adj2c': {n: 7, edges: [[0,4],[1,5],[1,6],[2,5],[2,6]]},
    // Kirchhoff cospectral
    'ex-kirchhoff1a': {n: 6, edges: [[0,3],[0,5],[1,4],[1,5],[2,4],[2,5],[3,5]]},
    'ex-kirchhoff1b': {n: 6, edges: [[0,3],[0,4],[0,5],[1,3],[1,4],[1,5],[2,5]]},
    'ex-kirchhoff2a': {n: 7, edges: [[0,4],[0,5],[0,6],[1,4],[1,5],[1,6],[2,4],[2,6],[3,5],[4,6]]},
    'ex-kirchhoff2b': {n: 7, edges: [[0,3],[0,6],[1,4],[1,5],[2,4],[2,5],[3,6],[4,5],[4,6],[5,6]]},
    'ex-kirchhoff2c': {n: 7, edges: [[0,3],[0,5],[0,6],[1,4],[1,5],[1,6],[2,4],[2,5],[2,6],[5,6]]},
    // Signless cospectral
    'ex-signless1a': {n: 6, edges: [[0,4],[0,5],[1,4],[1,5],[2,4],[2,5],[3,5],[4,5]]},
    'ex-signless1b': {n: 6, edges: [[0,3],[0,4],[0,5],[1,5],[2,5],[3,4],[3,5],[4,5]]},
    'ex-signless2a': {n: 7, edges: [[0,3],[0,5],[1,4],[1,5],[1,6],[2,4],[2,5],[2,6],[3,6],[4,6],[5,6]]},
    'ex-signless2b': {n: 7, edges: [[0,3],[0,5],[0,6],[1,4],[1,5],[1,6],[2,4],[2,5],[2,6],[3,6],[5,6]]},
    'ex-signless2c': {n: 7, edges: [[0,2],[0,4],[0,5],[0,6],[1,3],[1,5],[2,4],[2,5],[2,6],[3,6],[5,6]]},
    // Laplacian cospectral (connected)
    'ex-lap1a': {n: 7, edges: [[0,4],[0,5],[0,6],[1,5],[1,6],[2,5],[2,6],[3,5],[3,6],[4,5],[4,6],[5,6]]},
    'ex-lap1b': {n: 7, edges: [[0,3],[0,4],[0,5],[0,6],[1,3],[1,4],[1,5],[1,6],[2,4],[2,5],[2,6],[3,6],[4,6],[5,6]]},
    'ex-lap2a': {n: 6, edges: [[0,5],[1,5],[2,5],[3,5],[4,5]]},
    'ex-lap2b': {n: 6, edges: [[0,4],[0,5],[1,4],[1,5],[2,4],[2,5],[3,4],[3,5]]},
    'ex-lap2c': {n: 6, edges: [[0,3],[0,4],[0,5],[1,3],[1,4],[1,5],[2,3],[2,4],[2,5]]},
    // NB cospectral (min_degree >= 2)
    'ex-nb1a': {n: 8, edges: [[0,3],[0,6],[0,7],[1,4],[1,5],[1,6],[1,7],[2,4],[2,5],[3,6],[3,7],[4,5],[4,7],[5,7]]},
    'ex-nb1b': {n: 8, edges: [[0,3],[0,4],[0,6],[0,7],[1,5],[1,6],[1,7],[2,5],[2,7],[3,4],[3,6],[3,7],[4,6],[5,7]]},
    'ex-nb2a': {n: 9, edges: [[0,4],[0,6],[0,8],[1,5],[1,7],[1,8],[2,6],[2,7],[2,8],[3,7],[3,8],[4,8],[5,7]]},
    'ex-nb2b': {n: 9, edges: [[0,4],[0,6],[0,7],[0,8],[1,5],[1,7],[1,8],[2,6],[2,8],[3,7],[3,8],[4,6],[5,8]]},
    // NBL cospectral (n=10, m=18, min_degree>=2)
    'ex-nbl1a': {n: 10, edges: [[0,4],[0,5],[0,9],[1,4],[1,6],[1,8],[2,5],[2,7],[2,8],[3,6],[3,7],[3,9],[4,8],[5,7],[5,9],[6,8],[6,9],[8,9]]},
    'ex-nbl1b': {n: 10, edges: [[0,4],[0,5],[0,8],[1,4],[1,6],[1,9],[2,5],[2,7],[2,9],[3,6],[3,7],[3,8],[4,8],[5,7],[5,9],[6,8],[6,9],[8,9]]},
    'ex-nbl2a': {n: 10, edges: [[0,4],[0,5],[0,8],[0,9],[1,4],[1,6],[1,8],[2,5],[2,7],[2,8],[2,9],[3,6],[3,7],[3,9],[4,8],[5,7],[6,7],[6,9]]},
    'ex-nbl2b': {n: 10, edges: [[0,4],[0,5],[0,7],[0,9],[1,4],[1,6],[1,8],[2,5],[2,7],[2,8],[2,9],[3,6],[3,7],[3,9],[4,8],[5,7],[6,8],[6,9]]}
};

function renderExamples() {
    const style = getComputedStyle(document.documentElement);
    const nodeColor = style.getPropertyValue('--graph-node-color').trim();
    const edgeColor = style.getPropertyValue('--graph-edge-color').trim();

    Object.entries(exampleGraphs).forEach(([id, g]) => {
        const width = 100, height = 100;
        const nodes = Array.from({length: g.n}, (_, i) => ({id: i}));
        const links = g.edges.map(([s, t]) => ({source: s, target: t}));

        const svg = d3.select("#" + id)
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        const container = svg.append("g");

        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(25))
            .force("charge", d3.forceManyBody().strength(-50))
            .force("center", d3.forceCenter(width / 2, height / 2));

        const link = container.append("g")
            .selectAll("line")
            .data(links)
            .join("line")
            .attr("stroke", edgeColor)
            .attr("stroke-width", 1.5);

        const node = container.append("g")
            .selectAll("circle")
            .data(nodes)
            .join("circle")
            .attr("r", 4)
            .attr("fill", nodeColor);

        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);
            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);
        });
    });
}
</script>
<script src="https://d3js.org/d3.v7.min.js" onload="renderExamples()"></script>
{% endblock %}
