{% extends "base.html" %}

{% block title %}SMOL - Spectra and Matrices Of Little graphs{% endblock %}

{% block content %}
<hgroup class="hero">
    <h1>SMOL Graph DB</h1>
    <p>Spectra and matrices of all simple connected graphs up to 10 vertices.</p>
</hgroup>

<div class="search-box" x-data="{ tab: 'lookup' }">
    <div class="tab-pills">
        <button type="button" :class="{ active: tab === 'lookup' }" @click="tab = 'lookup'">Lookup</button>
        <button type="button" :class="{ active: tab === 'search' }" @click="tab = 'search'">Search</button>
        <button type="button" :class="{ active: tab === 'compare' }" @click="tab = 'compare'">Compare</button>
    </div>

    <div class="tab-content" x-show="tab === 'lookup'">
        <p class="tab-hint">Look up a graph by its <a href="/glossary#graph6">graph6</a> encoding.</p>
        <form class="lookup-form" onsubmit="window.location.href='/graph/' + encodeURIComponent(this.graph6.value); return false;">
            <input type="text" name="graph6" placeholder="e.g. D?{" required>
            <button type="submit">Go</button>
        </form>
    </div>

    <div class="tab-content" x-show="tab === 'compare'">
        <p class="tab-hint">Compare multiple graphs side by side. Enter 2-10 <a href="/glossary#graph6">graph6</a> strings, one per line.</p>
        <form onsubmit="compareGraphs(this); return false;">
            <textarea name="graphs" rows="4" placeholder="D?{&#10;DEo"></textarea>
            <div class="button-row">
                <button type="submit">Compare</button>
            </div>
        </form>
    </div>

    <div class="tab-content" x-show="tab === 'search'">
        <p class="tab-hint">Find graphs by structural properties.</p>
        <form hx-get="/graphs" hx-target="#results" hx-trigger="submit">
            <div class="filter-row">
                <label>
                    <span>Vertices</span>
                    <select name="n">
                        <option value="">any</option>
                        {% for i in range(1, 11) %}
                        <option value="{{ i }}">{{ i }}</option>
                        {% endfor %}
                    </select>
                </label>
                <label>
                    <span>Edges</span>
                    <input type="number" name="m" min="0" max="45" placeholder="any">
                </label>
                <label>
                    <span>Limit</span>
                    <select name="limit">
                        <option value="20">20</option>
                        <option value="50">50</option>
                        <option value="100" selected>100</option>
                        <option value="500">500</option>
                    </select>
                </label>
            </div>
            <div class="filter-row">
                <label class="checkbox-label">
                    <input type="checkbox" name="bipartite" value="true">
                    Bipartite
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" name="planar" value="true">
                    Planar
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" name="regular" value="true">
                    Regular
                </label>
                <button type="submit">Search</button>
            </div>
        </form>
    </div>
</div>

<section id="results"></section>

<section class="examples">
    <h3>Example Graphs</h3>
    <div class="examples-grid">
        <a href="/graph/D~{" class="example-card">
            <div id="ex-k5" class="example-viz"></div>
            <div class="example-label">K₅ complete</div>
        </a>
        <a href="/graph/EEh_" class="example-card">
            <div id="ex-c6" class="example-viz"></div>
            <div class="example-label">C₆ cycle</div>
        </a>
        <a href="/graph/E%3FBw" class="example-card">
            <div id="ex-s6" class="example-viz"></div>
            <div class="example-label">S₆ star</div>
        </a>
        <a href="/graph/G%3FzTb_" class="example-card">
            <div id="ex-cube" class="example-viz"></div>
            <div class="example-label">Q₃ cube</div>
        </a>
    </div>
</section>

<section class="examples">
    <h3>Cospectral Families</h3>
    <p class="examples-subtitle">Graphs with identical spectra but different structure</p>

    <h4 class="matrix-type">Adjacency</h4>
    <div class="cospectral-families">
        <a href="/compare?graphs=D%3F%7B,DEo" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-adj1a" class="example-viz"></div>
                    <code>D?{</code>
                </div>
                <div class="family-graph">
                    <div id="ex-adj1b" class="example-viz"></div>
                    <code>DEo</code>
                </div>
            </div>
        </a>
        <a href="/compare?graphs=ECRw,EEiW" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-adj2a" class="example-viz"></div>
                    <code>ECRw</code>
                </div>
                <div class="family-graph">
                    <div id="ex-adj2b" class="example-viz"></div>
                    <code>EEiW</code>
                </div>
            </div>
        </a>
    </div>

    <h4 class="matrix-type">Laplacian</h4>
    <div class="cospectral-families">
        <a href="/compare?graphs=CF,C%5D" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-lap1a" class="example-viz"></div>
                    <code>CF</code>
                </div>
                <div class="family-graph">
                    <div id="ex-lap1b" class="example-viz"></div>
                    <code>C]</code>
                </div>
            </div>
        </a>
        <a href="/compare?graphs=E%3FzW,ECxw" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-lap2a" class="example-viz"></div>
                    <code>E?zW</code>
                </div>
                <div class="family-graph">
                    <div id="ex-lap2b" class="example-viz"></div>
                    <code>ECxw</code>
                </div>
            </div>
        </a>
    </div>

    <h4 class="matrix-type">Non-backtracking</h4>
    <div class="cospectral-families">
        <a href="/compare?graphs=DC%7B,DEk" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-nb1a" class="example-viz"></div>
                    <code>DC{</code>
                </div>
                <div class="family-graph">
                    <div id="ex-nb1b" class="example-viz"></div>
                    <code>DEk</code>
                </div>
            </div>
        </a>
        <a href="/compare?graphs=E%3Fro,E%3FzO" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-nb2a" class="example-viz"></div>
                    <code>E?ro</code>
                </div>
                <div class="family-graph">
                    <div id="ex-nb2b" class="example-viz"></div>
                    <code>E?zO</code>
                </div>
            </div>
        </a>
    </div>

    <h4 class="matrix-type">NB-Laplacian</h4>
    <div class="cospectral-families">
        <a href="/compare?graphs=CF,CU" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-nbl1a" class="example-viz"></div>
                    <code>CF</code>
                </div>
                <div class="family-graph">
                    <div id="ex-nbl1b" class="example-viz"></div>
                    <code>CU</code>
                </div>
            </div>
        </a>
        <a href="/compare?graphs=E%3Fbw,ECZG" class="family-card">
            <div class="family-graphs">
                <div class="family-graph">
                    <div id="ex-nbl2a" class="example-viz"></div>
                    <code>E?bw</code>
                </div>
                <div class="family-graph">
                    <div id="ex-nbl2b" class="example-viz"></div>
                    <code>ECZG</code>
                </div>
            </div>
        </a>
    </div>
</section>

<script>
function compareGraphs(form) {
    const text = form.graphs.value.trim();
    const graphs = text.split(/[\n,]+/).map(g => g.trim()).filter(g => g);
    if (graphs.length < 2) {
        alert('Please enter at least 2 graphs to compare');
        return;
    }
    if (graphs.length > 10) {
        alert('Maximum 10 graphs allowed');
        return;
    }
    const params = graphs.map(g => encodeURIComponent(g)).join(',');
    window.location.href = '/compare?graphs=' + params;
}

const exampleGraphs = {
    // Example graphs
    'ex-k5': {n: 5, edges: [[0,1],[0,2],[0,3],[0,4],[1,2],[1,3],[1,4],[2,3],[2,4],[3,4]]},
    'ex-c6': {n: 6, edges: [[0,3],[0,4],[1,3],[1,5],[2,4],[2,5]]},
    'ex-s6': {n: 6, edges: [[0,5],[1,5],[2,5],[3,5],[4,5]]},
    'ex-cube': {n: 8, edges: [[0,4],[0,5],[0,6],[1,4],[1,5],[1,7],[2,4],[2,6],[2,7],[3,5],[3,6],[3,7]]},
    // Adjacency cospectral
    'ex-adj1a': {n: 5, edges: [[0,4],[1,4],[2,4],[3,4]]},
    'ex-adj1b': {n: 5, edges: [[0,3],[0,4],[1,3],[1,4]]},
    'ex-adj2a': {n: 6, edges: [[0,3],[0,5],[1,4],[1,5],[2,5],[3,5],[4,5]]},
    'ex-adj2b': {n: 6, edges: [[0,3],[0,4],[0,5],[1,3],[2,4],[3,5],[4,5]]},
    // Laplacian cospectral
    'ex-lap1a': {n: 4, edges: [[0,3],[1,3],[2,3]]},
    'ex-lap1b': {n: 4, edges: [[0,2],[0,3],[1,2],[1,3]]},
    'ex-lap2a': {n: 6, edges: [[0,4],[0,5],[1,4],[1,5],[2,4],[3,5],[4,5]]},
    'ex-lap2b': {n: 6, edges: [[0,3],[0,4],[1,4],[1,5],[2,4],[2,5],[3,5],[4,5]]},
    // NB cospectral
    'ex-nb1a': {n: 5, edges: [[0,3],[0,4],[1,4],[2,4],[3,4]]},
    'ex-nb1b': {n: 5, edges: [[0,3],[0,4],[1,3],[2,4],[3,4]]},
    'ex-nb2a': {n: 6, edges: [[0,4],[0,5],[1,4],[1,5],[2,5],[3,5]]},
    'ex-nb2b': {n: 6, edges: [[0,4],[0,5],[1,4],[1,5],[2,4],[3,5]]},
    // NBL cospectral
    'ex-nbl1a': {n: 4, edges: [[0,3],[1,3],[2,3]]},
    'ex-nbl1b': {n: 4, edges: [[0,2],[0,3],[1,3]]},
    'ex-nbl2a': {n: 6, edges: [[0,4],[0,5],[1,5],[2,5],[3,5],[4,5]]},
    'ex-nbl2b': {n: 6, edges: [[0,3],[0,5],[1,4],[1,5],[2,4],[4,5]]}
};

function renderExamples() {
    const style = getComputedStyle(document.documentElement);
    const nodeColor = style.getPropertyValue('--graph-node-color').trim();
    const edgeColor = style.getPropertyValue('--graph-edge-color').trim();

    Object.entries(exampleGraphs).forEach(([id, g]) => {
        const width = 100, height = 100;
        const nodes = Array.from({length: g.n}, (_, i) => ({id: i}));
        const links = g.edges.map(([s, t]) => ({source: s, target: t}));

        const svg = d3.select("#" + id)
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        const container = svg.append("g");

        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(25))
            .force("charge", d3.forceManyBody().strength(-50))
            .force("center", d3.forceCenter(width / 2, height / 2));

        const link = container.append("g")
            .selectAll("line")
            .data(links)
            .join("line")
            .attr("stroke", edgeColor)
            .attr("stroke-width", 1.5);

        const node = container.append("g")
            .selectAll("circle")
            .data(nodes)
            .join("circle")
            .attr("r", 4)
            .attr("fill", nodeColor);

        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);
            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);
        });
    });
}
</script>
<script src="https://d3js.org/d3.v7.min.js" onload="renderExamples()"></script>
{% endblock %}
