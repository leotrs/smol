{% extends "base.html" %}

{% block title %}{{ graph.graph6 }} - SMOL{% endblock %}

{% block content %}
<h2>{{ graph.graph6 }}</h2>
<p>{{ graph.n }} vertices, {{ graph.m }} edges</p>

<div id="graph-viz" style="width: 300px; height: 300px; border: 1px solid #ccc; margin-bottom: 1em;"></div>
<script src="https://d3js.org/d3.v7.min.js" onload="renderGraph()"></script>
<script>
function renderGraph() {
    const n = {{ graph.n }};
    const edges = {{ graph.edges | tojson }};

    const width = 300, height = 300;
    const nodes = Array.from({length: n}, (_, i) => ({id: i}));
    const links = edges.map(([s, t]) => ({source: s, target: t}));

    const svg = d3.select("#graph-viz")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

    const simulation = d3.forceSimulation(nodes)
        .force("link", d3.forceLink(links).id(d => d.id).distance(50))
        .force("charge", d3.forceManyBody().strength(-100))
        .force("center", d3.forceCenter(width / 2, height / 2));

    const link = svg.append("g")
        .selectAll("line")
        .data(links)
        .join("line")
        .attr("stroke", "#999")
        .attr("stroke-width", 2);

    const node = svg.append("g")
        .selectAll("circle")
        .data(nodes)
        .join("circle")
        .attr("r", 8)
        .attr("fill", "#4a90d9");

    const label = svg.append("g")
        .selectAll("text")
        .data(nodes)
        .join("text")
        .text(d => d.id)
        .attr("font-size", "10px")
        .attr("text-anchor", "middle")
        .attr("dy", "0.35em")
        .attr("fill", "white");

    simulation.on("tick", () => {
        link
            .attr("x1", d => d.source.x)
            .attr("y1", d => d.source.y)
            .attr("x2", d => d.target.x)
            .attr("y2", d => d.target.y);
        node
            .attr("cx", d => d.x)
            .attr("cy", d => d.y);
        label
            .attr("x", d => d.x)
            .attr("y", d => d.y);
    });
}
</script>

<h3>Properties</h3>
<ul>
    <li>Bipartite: {{ "yes" if graph.properties.is_bipartite else "no" }}</li>
    <li>Planar: {{ "yes" if graph.properties.is_planar else "no" }}</li>
    <li>Regular: {{ "yes" if graph.properties.is_regular else "no" }}</li>
    <li>Diameter: {{ graph.properties.diameter if graph.properties.diameter else "∞" }}</li>
    <li>Girth: {{ graph.properties.girth if graph.properties.girth else "∞ (acyclic)" }}</li>
    <li>Radius: {{ graph.properties.radius if graph.properties.radius else "-" }}</li>
    <li>Degree range: [{{ graph.properties.min_degree }}, {{ graph.properties.max_degree }}]</li>
    <li>Triangles: {{ graph.properties.triangle_count }}</li>
</ul>

<h3>Cospectral Mates</h3>
<table border="1">
    <tr>
        <th>Matrix</th>
        <th>Hash</th>
        <th>Mates</th>
        <th></th>
    </tr>
    <tr>
        <td>adjacency</td>
        <td><code>{{ graph.spectra.adj_hash }}</code></td>
        <td>
            {% if graph.cospectral_mates.adj %}
                {% for mate in graph.cospectral_mates.adj %}
                    <a href="/graph/{{ mate | urlencode }}">{{ mate }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
            {% else %}
                <em>none</em>
            {% endif %}
        </td>
        <td>
            {% if graph.cospectral_mates.adj %}
                <a href="/compare?graphs={{ graph.graph6 | urlencode }},{{ graph.cospectral_mates.adj | join(',') | urlencode }}">compare</a>
            {% endif %}
        </td>
    </tr>
    <tr>
        <td>laplacian</td>
        <td><code>{{ graph.spectra.lap_hash }}</code></td>
        <td>
            {% if graph.cospectral_mates.lap %}
                {% for mate in graph.cospectral_mates.lap %}
                    <a href="/graph/{{ mate | urlencode }}">{{ mate }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
            {% else %}
                <em>none</em>
            {% endif %}
        </td>
        <td>
            {% if graph.cospectral_mates.lap %}
                <a href="/compare?graphs={{ graph.graph6 | urlencode }},{{ graph.cospectral_mates.lap | join(',') | urlencode }}">compare</a>
            {% endif %}
        </td>
    </tr>
    <tr>
        <td>non-backtracking</td>
        <td><code>{{ graph.spectra.nb_hash }}</code></td>
        <td>
            {% if graph.cospectral_mates.nb %}
                {% for mate in graph.cospectral_mates.nb %}
                    <a href="/graph/{{ mate | urlencode }}">{{ mate }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
            {% else %}
                <em>none</em>
            {% endif %}
        </td>
        <td>
            {% if graph.cospectral_mates.nb %}
                <a href="/compare?graphs={{ graph.graph6 | urlencode }},{{ graph.cospectral_mates.nb | join(',') | urlencode }}">compare</a>
            {% endif %}
        </td>
    </tr>
    <tr>
        <td>nb-laplacian</td>
        <td><code>{{ graph.spectra.nbl_hash }}</code></td>
        <td>
            {% if graph.cospectral_mates.nbl %}
                {% for mate in graph.cospectral_mates.nbl %}
                    <a href="/graph/{{ mate | urlencode }}">{{ mate }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
            {% else %}
                <em>none</em>
            {% endif %}
        </td>
        <td>
            {% if graph.cospectral_mates.nbl %}
                <a href="/compare?graphs={{ graph.graph6 | urlencode }},{{ graph.cospectral_mates.nbl | join(',') | urlencode }}">compare</a>
            {% endif %}
        </td>
    </tr>
</table>

<h3>Spectra</h3>
<details>
    <summary>Adjacency eigenvalues ({{ graph.spectra.adj_eigenvalues|length }})</summary>
    <pre>{{ graph.spectra.adj_eigenvalues }}</pre>
</details>
<details>
    <summary>Laplacian eigenvalues ({{ graph.spectra.lap_eigenvalues|length }})</summary>
    <pre>{{ graph.spectra.lap_eigenvalues }}</pre>
</details>
<details>
    <summary>Non-backtracking eigenvalues ({{ graph.spectra.nb_eigenvalues_re|length }})</summary>
    <pre>{% for i in range(graph.spectra.nb_eigenvalues_re|length) %}{{ "%.6f"|format(graph.spectra.nb_eigenvalues_re[i]) }}{% if graph.spectra.nb_eigenvalues_im[i] >= 0 %}+{% endif %}{{ "%.6f"|format(graph.spectra.nb_eigenvalues_im[i]) }}j{% if not loop.last %}, {% endif %}{% endfor %}</pre>
</details>
<details>
    <summary>NB-Laplacian eigenvalues ({{ graph.spectra.nbl_eigenvalues_re|length }})</summary>
    <pre>{% for i in range(graph.spectra.nbl_eigenvalues_re|length) %}{{ "%.6f"|format(graph.spectra.nbl_eigenvalues_re[i]) }}{% if graph.spectra.nbl_eigenvalues_im[i] >= 0 %}+{% endif %}{{ "%.6f"|format(graph.spectra.nbl_eigenvalues_im[i]) }}j{% if not loop.last %}, {% endif %}{% endfor %}</pre>
</details>
{% endblock %}
